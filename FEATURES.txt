================================================================
  SYNCLEARN ‚Äî FEATURE & CODE GUIDE
  Last updated: February 2026
================================================================

STRUCTURE
---------
synclearn_mono_repo/
  Server/    ‚Üí  Express + MongoDB REST API      (port 5000)
  client/    ‚Üí  React + Vite  (Student Portal)  (port 5173)
  website/   ‚Üí  React + Vite  (Teacher/Admin)   (port 5174)


================================================================
BACKEND (Server/)
================================================================

TECH: Node.js, Express.js, MongoDB, Mongoose, JWT, BcryptJS

--- ENVIRONMENT (Server/.env) ---
  PORT=5000
  MONGO_URL=mongodb://localhost:27017/synclearn
  JWT_SECRET=your_secret
  BASE_URL=/api/v1/

--- ARCHITECTURE ---
Every feature follows:  Route ‚Üí Middleware ‚Üí Controller ‚Üí Service ‚Üí Model

  Route        ‚Äî defines URL, attaches auth middleware, calls controller
  Middleware   ‚Äî authenticate (verify JWT) + authorizeRoles (check role)
  Controller   ‚Äî extracts req data, calls service, sends HTTP response
  Service      ‚Äî all business logic + DB queries
  Model        ‚Äî Mongoose schema

--- UTILITIES ---
  catchAsync.js      ‚Üí wraps controller functions to auto-catch async errors
  ResponseUtils.js   ‚Üí serviceOk / serviceFail (service layer)
                       successResponse / errorResponse (HTTP layer)
  JwtUtils.js        ‚Üí generateToken({ _id, role }) | verifyToken(token)
  passwordUtils.js   ‚Üí hashPassword(plain) | comparePassword(plain, hash)
  authMiddleware.js  ‚Üí authenticate  ‚Äî reads Bearer token, sets req.user
                       authorizeRoles(...roles) ‚Äî 403 if role not allowed

--- MODELS ---
  Admin        : name, email, password(hidden)
  Teacher      : name, email, password(hidden), subject, classes[]
  Student      : name, email, password(hidden), class, rollNumber,
                 totalScore (Number, default 0), timestamps
  Lesson       : title, content, category, teacherId‚ÜíTeacher, isActive
  Quiz         : lessonId‚ÜíLesson (unique), questions[5]
                   question: questionText, options[4], correctAns(0-3 index)
  QuizAttempt  : quizId, studentId, answers[], score
  Announcement : title, message, adminId‚ÜíAdmin

--- API ENDPOINTS ---

AUTH (Public ‚Äî no token needed)
  POST  /api/v1/admin/register        { name, email, password }
  POST  /api/v1/admin/login           { email, password }
  POST  /api/v1/teacher/login         { email, password }
  POST  /api/v1/student/login         { email, password }

USER MANAGEMENT
  POST  /api/v1/admin/add-teacher     { name, email, password, subject, classes[] }  [Admin]
  POST  /api/v1/admin/add-student     { name, email, password, class, rollNumber }    [Admin]
  POST  /api/v1/teacher/add-student   { name, email, password, class, rollNumber }    [Teacher]
  GET   /api/v1/admin/teachers        returns all teachers (no passwords)             [Admin]
  GET   /api/v1/admin/students        returns all students (no passwords)             [Admin]

LESSONS
  GET   /api/v1/lesson                all active lessons (teacherId populated)        [All]
  GET   /api/v1/lesson/:id            single lesson                                   [All]
  POST  /api/v1/lesson                { title, content, category }                    [Teacher/Admin]
  PUT   /api/v1/lesson/:id            partial update (teacher owns or admin)          [Teacher/Admin]
  DELETE /api/v1/lesson/:id           (teacher owns or admin)                         [Teacher/Admin]

QUIZZES
  GET   /api/v1/quiz/lesson/:lessonId  fetch quiz ‚Äî correctAns STRIPPED for students  [All]
  POST  /api/v1/quiz                   { lessonId, questions[5] }                     [Teacher/Admin]
  POST  /api/v1/quiz/:id/submit        { answers: [0,2,1,3,0] } ‚Üí { score, total }   [Student]
  DELETE /api/v1/quiz/:id              (teacher owns or admin)                         [Teacher/Admin]

ANNOUNCEMENTS
  GET    /api/v1/announcement           all announcements                              [All]
  POST   /api/v1/announcement           { title, message }                             [Admin]
  DELETE /api/v1/announcement/:id                                                      [Admin]

--- QUIZ SCORE LOGIC ---
  1. Fetch quiz from DB
  2. For each question: answers[i] === quiz.questions[i].correctAns ‚Üí +1
  3. Save QuizAttempt record
  4. Student.totalScore += score  (via $inc)
  5. Return { score, total: 5 }

--- LOGIN RESPONSE SHAPE (ALL ROLES) ---
  Student login returns full profile in the user object:
    { token, user: { id, name, email, class, rollNumber, totalScore, role } }
  Teacher/Admin login returns:
    { token, user: { id, name, email, role } }

--- SECURITY ---
  ‚Ä¢ correctAns stripped server-side for students (never sent to client)
  ‚Ä¢ Passwords use select:false ‚Äî never returned in any query by default
  ‚Ä¢ Teacher ownership enforced in service layer for lesson + quiz mutations
  ‚Ä¢ Admin can bypass ownership checks
  ‚Ä¢ 401 auto-clears localStorage on frontend


================================================================
CLIENT APP (client/) ‚Äî Student Portal
================================================================

ROUTES
  /           ‚Üí redirects to /login
  /login      LoginPage        (public ‚Äî redirects to /home if already logged in)
  /home       HomePage         (private)
  /missions   MissionsPage     (private)
  *           ‚Üí redirects to /login (catch-all)

ROUTE GUARDS
  PublicRoute.jsx  ‚Äî redirects to /home if token exists in localStorage
  PrivateRoute.jsx ‚Äî redirects to /login if no token in localStorage

KEY FILES
  src/api/axiosClient.js
    ‚Äî baseURL from VITE_API_URL env var
    ‚Äî request interceptor: auto-attaches Authorization: Bearer <token>
    ‚Äî response interceptor:
        401        ‚Üí clear localStorage + redirect /login
        no-response ‚Üí toast "Cannot reach server"
        other error ‚Üí toast with server error message

  src/api/authService.js
    loginStudent(credentials)    ‚Üí POST student/login
                                    stores token + full user object in localStorage
                                    (includes class, rollNumber, totalScore)
    getStudentProfile()          ‚Üí GET student/profile  (authenticated)
    logoutStudent()              ‚Üí removes 'token' and 'user' from localStorage

  src/api/missionService.js
    getAllLessons()               ‚Üí GET lesson
    getLessonById(id)            ‚Üí GET lesson/:id
    getQuizForLesson(lessonId)   ‚Üí GET quiz/lesson/:id  (no correctAns)
    submitQuiz(quizId, answers)  ‚Üí POST quiz/:id/submit
    getAnnouncements()           ‚Üí GET announcement

  src/constants/apiEndpoints.js
    Single source of all API route strings. No URLs in components.
    Namespaces: AUTH, STUDENTS, LESSONS, QUIZ, ANNOUNCEMENTS
    Frozen with Object.freeze() to prevent accidental mutation.

    AUTH.LOGIN            ‚Üí 'student/login'
    STUDENTS.PROFILE      ‚Üí 'student/profile'
    STUDENTS.ALL          ‚Üí 'student'
    LESSONS.BASE          ‚Üí 'lesson'
    LESSONS.BY_ID(id)     ‚Üí 'lesson/:id'
    QUIZ.BY_LESSON(id)    ‚Üí 'quiz/lesson/:id'
    QUIZ.BASE             ‚Üí 'quiz'
    QUIZ.SUBMIT(id)       ‚Üí 'quiz/:id/submit'
    ANNOUNCEMENTS.BASE    ‚Üí 'announcement'

  src/utils/toast.js
    showToast.success(msg)
    showToast.error(msg)
    showToast.alert(msg)

PAGES
  LoginPage
    ‚Äî Student login form
    ‚Äî Shows success toast on login, navigates to /home
    ‚Äî On error: error toast from axiosClient interceptor

  HomePage
    ‚Äî Sticky top bar with SyncLearn logo and Logout button
    ‚Äî Welcome greeting: "Welcome back, {firstName}! üëã"
    ‚Äî BroadcastFeed component (live list of ALL admin announcements)
        ‚Ä¢ Scrollable list (max-h-72), shows title + message + formatted date
        ‚Ä¢ Animated violet ping dot to indicate live feed
        ‚Ä¢ Badge with count of active announcements
        ‚Ä¢ Skeleton loading state while fetching
    ‚Äî Quick nav card: "My Missions" ‚Üí /missions
    ‚Äî Student info card: shows name, email, class (from localStorage user)
      and totalScore displayed in large emerald text

  MissionsPage  ‚Äî full student mission workflow (sub-components below):
    ‚Ä¢ Sticky top bar with ‚Üê Home back button and student name
    ‚Ä¢ Announcements banner strip (latest 2 from admin, violet highlighted)
    ‚Ä¢ Search bar (filters by title or category)
    ‚Ä¢ Lesson count ("X available") updates with search filter
    ‚Ä¢ Skeleton loading (6 placeholder cards in grid)
    ‚Ä¢ Lesson card grid (1/2/3 columns responsive):
        LessonCard ‚Äî category badge, "Live" pulse dot if isActive,
                     title, content preview (120 chars), teacher name+subject,
                     animated ‚Üí arrow on hover
    ‚Ä¢ LessonModal (z-40) ‚Äî full content view:
        category badge, title, teacher + subject attribution,
        full content (whitespace-pre-wrap), "Start Quiz ‚Üí" button
    ‚Ä¢ QuizModal (z-50) ‚Äî quiz workflow:
        loading spinner ‚Üí question list ‚Üí result screen
        5 questions, A/B/C/D option buttons (violet highlight when selected)
        Submit Assessment button (disabled until all answered)
        Result screen: X/5 score, gradient progress bar, emoji message
        (üèÜ Perfect / ‚úÖ Well done / üìö Keep studying)
    ‚Ä¢ Uses Promise.all to fetch lessons + announcements in parallel on mount


================================================================
WEBSITE APP (website/) ‚Äî Teacher & Admin Portal
================================================================

ROUTES
  /login          LoginPage            (public)
  /home           HomePage             (private)
  /missions       MissionControlPage   (private)
  /announcements  AnnouncementsPage    (private)
  /teachers       ManageTeachersPage   (private)
  /students       ManageStudentsPage   (private)

KEY FILES
  src/api/authService.js
    loginTeacher(credentials)  ‚Üí POST teacher/login ‚Üí store token+user
    loginAdmin(credentials)    ‚Üí POST admin/login   ‚Üí store token+user
    logoutUser()               ‚Üí clear localStorage

  src/api/missionService.js
    Lesson: getAllLessons, getLessonById, createLesson, updateLesson, deleteLesson
    Quiz:   getQuizForLesson, createQuiz, deleteQuiz
    Announcement: getAnnouncements, createAnnouncement, deleteAnnouncement

  src/api/userService.js
    addTeacher(payload)         ‚Üí POST admin/add-teacher
    listTeachers()              ‚Üí GET  admin/teachers
    addStudent(payload, role)   ‚Üí POST admin/add-student  OR  teacher/add-student
    listStudents()              ‚Üí GET  admin/students

COMPONENTS
  Layout.jsx    ‚Äî collapsible sidebar with role-aware navigation
                  Admin sees: Dashboard, Missions, Students, Teachers, Broadcasts
                  Teacher sees: Dashboard, Missions, Students

PAGES
  LoginPage          ‚Äî toggle Teacher/Admin, calls correct login service
  HomePage           ‚Äî quick-launch card grid (4 for admin, 2 for teacher)
  MissionControlPage ‚Äî create lesson form + lesson list
                       expand a lesson ‚Üí inline QuizBuilder (5 Qs, pick correct answer)
  AnnouncementsPage  ‚Äî create announcement form + list with Remove button
  ManageTeachersPage ‚Äî Add Teacher form (name, email, password, subject, classes CSV)
                       Teacher roster table: Name | Email | Subject | Classes | Joined
                       (Admin only ‚Äî form submits classes as comma-split array)
  ManageStudentsPage ‚Äî Enroll Student form + student table with score column
                       (table visible to admin only; teachers see form only)


================================================================
AUTH TOKEN FLOW (IMPORTANT)
================================================================

Server response shape for ALL endpoints:
  { success: true, message: "...", data: { ...payload } }

For login, data = { token, user }
So on frontend: response.data.data.token  (NOT response.data.token)

localStorage keys:
  "token"  ‚Üí JWT string
  "user"   ‚Üí JSON stringified user object
               Student: { id, name, email, class, rollNumber, totalScore, role }
               Teacher: { id, name, email, role }
               Admin:   { id, name, email, role }

================================================================
